# 🎯 Edu_Hangul 핵심 기능 완성도 체크리스트

생성일: 2026-02-10
최종 업데이트: 2026-02-10

---

## 📋 1순위: 핵심 기능 완성도 검증 (1-2주)

### ✅ 음성 대화 기능 완벽 작동? (목표: 에러율 5% 이하)

#### 현재 상태: ⚠️ **개선 필요 (60%)**

**✅ 작동하는 것:**
- [x] Web Speech API 음성 인식
- [x] Google Cloud TTS 음성 합성
- [x] 실시간 transcript 표시
- [x] 세션별 대화 저장
- [x] 크레딧 차감 시스템

**❌ 발견된 Critical 이슈 (즉시 수정 필요):**
- [ ] **#1 - 크레딧 계산 로직 불일치** (HIGH)
  - 위치: `functions/src/speech/voiceChat.ts:191-193`
  - 문제: 차감 후 잘못된 잔여 시간 반환
  - 영향: Free/Free+ 사용자에게 부정확한 잔여 시간 표시
  - 수정 방법: `deductVoiceCredits` 반환값 사용

- [ ] **#3 - 음성 인식 재시작 시 메모리 누수** (MEDIUM)
  - 위치: `src/hooks/useSpeechRecognition.ts:116-132`
  - 문제: 이미 실행 중일 때 재시작 안됨
  - 수정 방법: 기존 recognition stop() 후 재시작

- [ ] **#4 - TTS 오디오 재생 실패 시 알림 없음** (MEDIUM)
  - 위치: `src/components/VoiceChat.tsx:291-304`
  - 문제: 에러 발생 시 console.error만
  - 수정 방법: 사용자 알림 추가

**⚠️ High Priority 개선 사항:**
- [ ] **#5 - 세션 설정이 백엔드에 전달되지 않음** (HIGH)
  - 프론트엔드는 persona, responseStyle 등을 전송하지만 백엔드가 무시
  - 영향: 사용자 맞춤 설정 작동 안 함

- [ ] **#2 - alert() 대신 Toast 사용** (MEDIUM)
  - 18개 파일에서 alert() 사용
  - UX 저하 원인

**🔬 테스트 시나리오:**
1. [ ] 1분 음성 대화 → 크레딧 정확히 차감?
2. [ ] 마이크 권한 거부 → 명확한 가이드 표시?
3. [ ] 네트워크 오류 시 → 사용자 친화적 에러?
4. [ ] Persona 변경 → 응답 스타일 반영?
5. [ ] 긴 대화 (5분+) → 메모리 누수 없음?

**예상 에러율:** 현재 15-20% → 목표 5%

---

### ✅ 텍스트 채팅 기능 완벽 작동?

#### 현재 상태: ⚠️ **개선 필요 (70%)**

**✅ 작동하는 것:**
- [x] Claude API 통합 (Sonnet/Haiku)
- [x] 실시간 스트리밍 응답
- [x] 메시지 히스토리 (최근 20개)
- [x] 자동 스크롤
- [x] Enter/Shift+Enter 처리

**❌ 발견된 Critical 이슈:**
- [ ] **#9 - textChat.ts와 chatStream.ts 중복 구현** (HIGH)
  - 같은 기능을 두 파일에서 구현
  - 유지보수 복잡성 증가, 버그 위험
  - 수정 방법: 하나로 통합

- [ ] **#10 - 크레딧 차감 로직 불일치** (HIGH)
  - 텍스트 1회 = 30초 고정 (비합리적)
  - Voice는 실제 시간 기반인데 Text는 고정
  - 수정 방법: 토큰 수 기반 차감 고려

**⚠️ High Priority 개선 사항:**
- [ ] **#12 - 에러 메시지 미표시** (MEDIUM)
  - hook 내부에서 에러 처리되지만 UI에 표시 안됨
  - 사용자가 에러 원인 모름

- [ ] **#13 - 메시지 전송 중 중복 전송 가능** (MEDIUM)
  - 네트워크 지연 시 같은 메시지 여러 번 전송
  - 디바운싱 필요

**🔬 테스트 시나리오:**
1. [ ] 긴 메시지 전송 → 스트리밍 정상?
2. [ ] 빠르게 연속 전송 → 중복 없음?
3. [ ] 네트워크 오류 → 명확한 에러 표시?
4. [ ] 20개 이상 메시지 → 히스토리 제한 작동?
5. [ ] Pro vs Free tier → 모델 차등 적용?

**예상 에러율:** 현재 10-15% → 목표 5%

---

### ✅ 발음 교정 정확도 테스트

#### 현재 상태: ❌ **심각한 문제 (40%)**

**✅ 작동하는 것:**
- [x] Claude API 기반 텍스트 분석
- [x] 4가지 영역 평가 (발음, 어휘, 문법, 유창성)
- [x] 점수 및 피드백 제공

**❌ 발견된 Critical 이슈:**
- [ ] **#14 - 발음 분석의 정확성 부족** (CRITICAL!)
  - 위치: `functions/src/speech/detailedAnalysis.ts`
  - 심각한 문제: 실제 발음 오디오를 분석하지 않음
  - 현재: 대화 텍스트만 보고 "발음" 점수 추론
  - 영향: 발음 교정 기능이 사실상 작동 안 함
  - 수정 방법: Google Speech-to-Text API의 pronunciation assessment 활용

- [ ] **#15 - JSON 파싱 실패 시 폴백 부적절** (HIGH)
  - 모든 점수를 75로 고정
  - 사용자에게 오해 유발

- [ ] **#16 - 최소 요구사항 체크 부족** (MEDIUM)
  - 현재: 3분 OR 500자
  - 문제: 짧은 대화에서도 분석 제공 → 부정확
  - 수정: 최소 메시지 수 조건 추가

**🔬 테스트 시나리오:**
1. [ ] 명확한 발음 오류 → 정확히 감지?
2. [ ] 짧은 대화 (2분) → 분석 거부?
3. [ ] 고급 어휘 사용 → 제대로 평가?
4. [ ] 문법 오류 → 구체적 피드백?
5. [ ] 유창성 평가 → 정확한 점수?

**예상 정확도:** 현재 40% → 목표 80%+

**⚠️ 긴급 결정 필요:**
- 발음 분석 기능을 실제 오디오 기반으로 재구현할 것인가?
- 아니면 "텍스트 기반 대화 분석"으로 기능명 변경?

---

### ✅ 문법 분석 정확도 테스트

#### 현재 상태: ✅ **양호 (75%)**

**✅ 작동하는 것:**
- [x] Claude API의 문법 분석
- [x] 구체적 피드백 제공
- [x] 개선 제안

**⚠️ 개선 사항:**
- [ ] 실제 문법 오류 없을 때도 피드백 제공 (과잉 교정)
- [ ] 한국어 특수 문법 (존댓말, 종결어미) 정확도 검증 필요

**🔬 테스트 시나리오:**
1. [ ] 명확한 문법 오류 10가지 → 감지율?
2. [ ] 완벽한 문법 → 불필요한 지적 없음?
3. [ ] 존댓말/반말 혼용 → 적절히 지적?
4. [ ] 초급/중급/고급 수준 → 수준별 피드백?

**예상 정확도:** 현재 75% → 목표 90%+

---

### ✅ 크레딧 시스템 정상 작동?

#### 현재 상태: ⚠️ **개선 필요 (65%)**

**✅ 작동하는 것:**
- [x] 티어별 주간 한도 관리
- [x] 자동 주간 리셋 (7일)
- [x] Analysis 평생/일일 제한
- [x] Assistant 주간 제한

**❌ 발견된 Critical 이슈:**
- [ ] **#20 - Race Condition in Credit Check/Deduct** (CRITICAL!)
  - 위치: `functions/src/speech/creditManager.ts`
  - 문제: 체크와 차감이 별도 트랜잭션
  - 영향: 동시 요청 시 크레딧 초과 사용 가능
  - 수정 방법: Firestore 트랜잭션으로 원자성 보장

- [ ] **#21 - Analysis 일일 리셋 버그** (HIGH)
  - `lastAnalysisReset`이 없는 사용자는 에러
  - null 체크 필요

**⚠️ High Priority 개선 사항:**
- [ ] **#19 - 주간 리셋 타이밍 불일치** (MEDIUM)
  - 사용자별로 다른 리셋 시간
  - 장점: 서버 부하 분산
  - 단점: 사용자 혼란
  - 개선: UI에 명확한 리셋 일시 표시

- [ ] **#22 - 크레딧 정보 캐싱 없음** (MEDIUM)
  - 매 요청마다 Firestore 읽기
  - 비용 증가, 레이턴시 증가
  - 개선: Redis 또는 메모리 캐싱

**🔬 테스트 시나리오:**
1. [ ] 한도 초과 시도 → 명확한 차단?
2. [ ] 7일 후 리셋 → 정확히 복구?
3. [ ] 동시 10개 요청 → Race condition 없음?
4. [ ] Pro tier → 무제한 작동?
5. [ ] 크레딧 UI → 실시간 업데이트?

**예상 안정성:** 현재 65% → 목표 95%+

---

### ✅ Stripe 결제 테스트 (실제 결제까지)

#### 현재 상태: ⚠️ **개선 필요 (70%)**

**✅ 작동하는 것:**
- [x] Checkout Session 생성
- [x] Customer Portal
- [x] Webhook 이벤트 처리
- [x] 구독 메타데이터 관리

**❌ 발견된 Critical 이슈:**
- [ ] **#24 - Webhook 서명 검증 후 에러 처리 불완전** (CRITICAL!)
  - 위치: `functions/src/stripe/webhooks.ts:67-70`
  - 문제: 핸들러 에러 시 500 응답 → Stripe 재시도
  - 하지만 복구 메커니즘 없음
  - 수정: 실패 이벤트를 별도 테이블에 저장

- [ ] **#25 - 메타데이터 누락 시 조용한 실패** (CRITICAL!)
  - `firebaseUID` 없으면 로그만 남기고 끝
  - 수정: 알림 시스템 (이메일, Slack) 연동

- [ ] **#26 - 학생 할인 검증 로직 미구현** (MEDIUM)
  - 주석만 있고 코드 없음
  - 결정 필요: 구현 vs 기능 제거

**⚠️ High Priority 개선 사항:**
- [ ] **#27 - 결제 실패 시 사용자 알림 없음** (HIGH)
  - `past_due` 상태로만 변경
  - 사용자가 모름
  - 개선: 이메일 자동 알림

- [ ] **#28 - 환경변수 폴백 값의 보안 문제** (MEDIUM)
  - 하드코딩된 price ID
  - 개선: 환경변수 필수로 설정

**🔬 실제 결제 테스트 체크리스트:**
1. [ ] **Free → Free+ 업그레이드**
   - [ ] Checkout 페이지 정상 로드
   - [ ] 카드 정보 입력 (테스트 모드)
   - [ ] 결제 성공 → Firestore 업데이트
   - [ ] 크레딧 즉시 반영
   - [ ] 이메일 영수증 발송

2. [ ] **Free → Pro 업그레이드**
   - [ ] 연간 결제 옵션 선택
   - [ ] 결제 성공 → Pro tier 활성화
   - [ ] 무제한 크레딧 확인

3. [ ] **구독 관리 (Customer Portal)**
   - [ ] Portal 접속
   - [ ] 플랜 변경 (Free+ → Pro)
   - [ ] 결제 수단 변경
   - [ ] 구독 취소
   - [ ] 취소 후 기간 종료까지 사용 가능?

4. [ ] **결제 실패 시나리오**
   - [ ] 카드 한도 초과
   - [ ] 카드 만료
   - [ ] 3D Secure 실패
   - [ ] 각 경우 사용자 알림 확인

5. [ ] **Webhook 이벤트 처리**
   - [ ] checkout.session.completed
   - [ ] customer.subscription.updated
   - [ ] customer.subscription.deleted
   - [ ] invoice.payment_failed
   - [ ] 각 이벤트마다 Firestore 정확히 업데이트?

**테스트 환경:**
- [ ] Stripe Test Mode 활성화
- [ ] 테스트 카드: 4242 4242 4242 4242
- [ ] Webhook 로컬 테스트: Stripe CLI

**예상 성공률:** 현재 70% → 목표 98%+

---

### ✅ 모바일 반응형 완벽?

#### 현재 상태: ⚠️ **테스트 필요 (미확인)**

**🔬 테스트 디바이스:**
1. [ ] iPhone SE (375px)
2. [ ] iPhone 14 Pro (393px)
3. [ ] Samsung Galaxy S21 (360px)
4. [ ] iPad (768px)
5. [ ] iPad Pro (1024px)

**체크 항목:**
- [ ] 모든 버튼이 터치 가능 (최소 44px)
- [ ] 텍스트 입력 필드 확대 안 됨
- [ ] 가로 스크롤 없음
- [ ] 폰트 크기 적절
- [ ] 음성 버튼 크고 명확
- [ ] 네비게이션 쉬움
- [ ] PWA 설치 후 풀스크린 작동

**예상 점수:** 미확인 → 목표 95%+

---

### ✅ 로딩 속도 2초 이내?

#### 현재 상태: ⚠️ **측정 필요 (미확인)**

**🔬 측정 도구:**
- [ ] Google PageSpeed Insights
- [ ] Lighthouse (Performance)
- [ ] WebPageTest

**측정 지표:**
- [ ] First Contentful Paint (FCP): < 1.8s
- [ ] Largest Contentful Paint (LCP): < 2.5s
- [ ] Total Blocking Time (TBT): < 200ms
- [ ] Cumulative Layout Shift (CLS): < 0.1
- [ ] Speed Index: < 3.0s

**최적화 항목:**
- [ ] **#34 - Firestore 읽기 최적화**
  - 매 메시지마다 20개 조회
  - 개선: 클라이언트 캐싱

- [ ] **#35 - Claude API 타임아웃 설정**
  - 현재: 타임아웃 없음
  - 개선: 30초 타임아웃

- [ ] **#36 - TTS 오디오 최적화** (CRITICAL!)
  - base64 인라인 전송 (대역폭 낭비)
  - 개선: Cloud Storage 업로드 후 URL 반환

**예상 점수:** 미확인 → 목표 90+/100

---

### ✅ Firebase 비용 예측 (예상 사용자 100명 기준)

#### 비용 계산 시나리오

**가정:**
- 100명 활성 사용자
- 평균 주 3회 사용
- 평균 세션 10분
- Voice:Text = 7:3

**Firestore 비용:**
- 읽기: 100명 × 3회/주 × 20개 메시지 × 4주 = 24,000회
- 쓰기: 100명 × 3회/주 × 10개 메시지 × 4주 = 12,000회
- 예상: **$0.20/월**

**Cloud Functions 비용:**
- 호출: 100명 × 3회/주 × 4주 = 1,200회
- 실행 시간: 1,200 × 10분 = 12,000 GB-초
- 예상: **$0.50/월**

**Google Cloud TTS 비용:**
- Voice 사용자: 100명 × 70% = 70명
- 세션당 응답: 10분 / 2분 = 5회
- 응답당 글자: 100자
- 총 글자: 70명 × 3회/주 × 4주 × 5응답 × 100자 = 420,000자
- 가격: $16/백만 자
- 예상: **$6.72/월**

**Claude API 비용:**
- 토큰 소비 추정: 100명 × 3회/주 × 4주 × 5,000토큰 = 6M 토큰
- Sonnet: $3/M input, $15/M output
- 예상: **$54/월**

**Firebase Hosting 비용:**
- PWA + static files
- 트래픽: 100명 × 100MB/월 = 10GB
- 예상: **무료** (10GB 무료 할당)

**총 예상 비용: ~$61.42/월 (사용자 100명 기준)**

**수익화 목표:**
- Free+ 사용자: 10명 × $9.99 = $99.90/월
- Pro 사용자: 5명 × $49.99 = $249.95/월
- **예상 수익: $349.85/월**
- **예상 이익: $288.43/월** (BEP: 18명)

**⚠️ 비용 최적화 필요:**
- [ ] #22 - 크레딧 정보 캐싱 (Firestore 읽기 50% 감소)
- [ ] #36 - TTS 오디오 URL화 (대역폭 70% 감소)
- [ ] #34 - 메시지 히스토리 캐싱 (API 호출 30% 감소)

---

## 🔧 즉시 수정 필요한 Critical 이슈 (Top 10)

### 우선순위 1 (당장 수정)
1. [ ] **#14 - 발음 분석 재구현** (BLOCKER!)
2. [ ] **#20 - Credit Race Condition** (DATA LOSS 위험!)
3. [ ] **#24 - Webhook 에러 처리** (PAYMENT 누락 위험!)
4. [ ] **#25 - 메타데이터 누락 알림** (PAYMENT 누락 위험!)

### 우선순위 2 (이번 주 내)
5. [ ] **#1 - Voice 크레딧 계산 로직**
6. [ ] **#10 - Text 크레딧 차감 로직**
7. [ ] **#9 - textChat 중복 코드 통합**
8. [ ] **#5 - 세션 설정 백엔드 전달**
9. [ ] **#36 - TTS 오디오 URL화** (성능 개선)
10. [ ] **#29 - 에러 처리 패턴 통일**

---

## 📊 전체 완성도 점수

| 항목 | 현재 | 목표 | 상태 |
|------|------|------|------|
| 음성 대화 | 60% | 95% | ⚠️ 개선 필요 |
| 텍스트 채팅 | 70% | 95% | ⚠️ 개선 필요 |
| 발음 교정 | 40% | 80% | ❌ 심각 |
| 문법 분석 | 75% | 90% | ✅ 양호 |
| 크레딧 시스템 | 65% | 95% | ⚠️ 개선 필요 |
| Stripe 결제 | 70% | 98% | ⚠️ 테스트 필요 |
| 모바일 반응형 | ? | 95% | ⏳ 미확인 |
| 로딩 속도 | ? | 90+ | ⏳ 미확인 |

**전체 평균: 63.3% → 목표 92%+**

---

## 🎯 다음 단계 실행 계획

### Week 1: Critical 이슈 수정
- [ ] Day 1-2: #14 발음 분석 재설계
- [ ] Day 3: #20, #24, #25 트랜잭션/Webhook 수정
- [ ] Day 4-5: #1, #10, #9 크레딧 로직 통합

### Week 2: 테스트 및 최적화
- [ ] Day 1: Stripe 실제 결제 테스트
- [ ] Day 2: 모바일 반응형 테스트
- [ ] Day 3: 성능 측정 및 최적화
- [ ] Day 4-5: 10가지 사용자 시나리오 테스트

---

## 📝 참고: 42개 전체 이슈 목록

자세한 내용은 코드 분석 보고서 참조.
- Critical: 4개
- High: 12개
- Medium: 18개
- Low: 8개

**생성 일시:** 2026-02-10 10:25 GMT
**다음 리뷰:** 2026-02-17
